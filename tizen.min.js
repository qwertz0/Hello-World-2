//v1.0
var $device=null;const $settings={autoselect:"false"!==localStorage.getItem("autoselect"),vMinEvents:7,vNum:2,foldEvents:"false"!==localStorage.getItem("foldEvents"),avplay:"true"===localStorage.getItem("avplay")||!1,s365pseudo:"true"===localStorage.getItem("s365pseudo")||!1};function start(){(function(){const a=document.createElement("div");a.id="schedule",a.className="schedule",a.style.opacity="0",a.innerHTML="<div class=\"schedule-dimmer\" id=\"dimmer\"></div><div class=\"schedule-menu\" id=\"menu\"><div class=\"menu-item menu-item--reload\" id=\"menuReload\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--de\" id=\"menuDe\"></div><div class=\"menu-item menu-item--main\" id=\"menuMain\"></div><div class=\"menu-item menu-item--fb\" id=\"menuFb\"></div><div class=\"menu-item menu-item--more\" id=\"menuMore\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--audio\" id=\"menuAudio\"></div><div class=\"menu-item menu-item--group\" id=\"menuGroup\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--settings\" id=\"menuSettings\"></div></div><div class=\"schedule-list\" id=\"list0\"></div><div class=\"schedule-list\" id=\"list1\"></div><div class=\"schedule-list\" id=\"listSettings\"><div class=\"setting\"><input type=\"checkbox\""+($settings.autoselect?" checked":"")+" id=\"setting_autoselect\"><label for=\"setting_autoselect\">Streams automatisch ausw\xE4hlen</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.foldEvents?" checked":"")+" id=\"setting_foldEvents\"><label for=\"setting_foldEvents\">Sprachen zu Untermen\xFCs zusammenfassen</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.avplay?" checked":"")+" id=\"setting_avplay\"><label for=\"setting_avplay\">AvPlay statt native Wiedergabe benutzen</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.s365pseudo?" checked":"")+" id=\"setting_s365pseudo\"><label for=\"setting_s365pseudo\">s365-Test (Neustart notwendig)</label></div></div></div><div class=\"msg-exit\"></div>",document.body.appendChild(a)})(),$device=function(){setting_foldEvents.checked=$settings.foldEvents,setting_autoselect.checked=$settings.autoselect,setting_avplay.checked=$settings.avplay,setting_s365pseudo.checked=$settings.s365pseudo;const a=function(){try{tizen.application.getCurrentApplication().exit()}catch(a){console.error("Application exit failed.",a)}};tizen.tvinputdevice.registerKeyBatch(["Info","MediaStop","MediaRewind","MediaFastForward","MediaPlay","ChannelUp","ChannelDown"]);var b=null;const c={focus:function(){switch(schedule.getAttribute("filter")){case"de":d.select(menuDe);break;case"fb":d.select(menuFb);break;case"main":d.select(menuMain);break;default:d.select(menuMore);}schedule.classList.add("schedule--menu")},close:function(a){e.focus($schedule.list()),a.classList.remove("menu-item--hover"),schedule.classList.remove("schedule--menu")}},d={previous:function(a){let b=a.previousElementSibling;for(;b&&!b.classList.contains("menu-item");)b=b.previousElementSibling;return b},next:function(a){let b=a.nextElementSibling;for(;b&&!b.classList.contains("menu-item");)b=b.nextElementSibling;return b},select:function(a){a.classList.add("menu-item--hover"),b=a},onKey:function(a){switch(a){case tizen.tvinputdevice.getKey("ArrowRight").code:c.close(this);break;case tizen.tvinputdevice.getKey("ArrowUp").code:(function(){let a=d.previous(this);a&&(d.select(a),this.classList.remove("menu-item--hover"))}).call(this);break;case tizen.tvinputdevice.getKey("ArrowDown").code:(function(){let a=d.next(this);a&&(d.select(a),this.classList.remove("menu-item--hover"))}).call(this);break;case tizen.tvinputdevice.getKey("Enter").code:switch(this.id){case"menuReload":$schedule.reload(!0,e.reset);break;case"menuDe":case"menuMain":case"menuFb":case"menuMore":localStorage.setItem("filter",$schedule.setFilter(this.id.substr(4).toLowerCase(),e.reset));break;case"menuAudio":localStorage.setItem("audiofilter",$schedule.toggleAudiofilter(e.reset));break;case"menuGroup":localStorage.setItem("grouping",$schedule.toggleGrouping(e.reset));break;case"menuSettings":schedule.classList.contains("schedule--settings")?c.close(this):$schedule.openSettings(()=>c.close(this));};break;case tizen.tvinputdevice.getKey("Back").code:c.close(this);}}},e={focus:function(a){const c=a.currentEvent||a.querySelector(".event");c&&c.offsetParent?f.select(c):b=a},onKey:function(b){b===tizen.tvinputdevice.getKey("ArrowLeft").code?c.focus():b===tizen.tvinputdevice.getKey("Back").code?document.documentElement.classList.contains("exit")?a():(document.documentElement.classList.add("exit"),setTimeout(()=>document.documentElement.classList.remove("exit"),1e3)):b===tizen.tvinputdevice.getKey("Info").code?$schedule.reload(!0,e.reset):void 0},settingsOnKey:function(a){switch(a){case tizen.tvinputdevice.getKey("ArrowUp").code:switch(this.selectedSetting){case"autoselect":break;case"foldEvents":this.selectedSetting="autoselect",setting_autoselect.parentElement.classList.add("setting--hover"),setting_foldEvents.parentElement.classList.remove("setting--hover");break;case"avplay":this.selectedSetting="foldEvents",setting_foldEvents.parentElement.classList.add("setting--hover"),setting_avplay.parentElement.classList.remove("setting--hover");break;case"s365pseudo":this.selectedSetting="avplay",setting_avplay.parentElement.classList.add("setting--hover"),setting_s365pseudo.parentElement.classList.remove("setting--hover");break;default:this.selectedSetting="autoselect",setting_autoselect.parentElement.classList.add("setting--hover");};break;case tizen.tvinputdevice.getKey("ArrowDown").code:switch(this.selectedSetting){case"autoselect":this.selectedSetting="foldEvents",setting_foldEvents.parentElement.classList.add("setting--hover"),setting_autoselect.parentElement.classList.remove("setting--hover");break;case"foldEvents":this.selectedSetting="avplay",setting_avplay.parentElement.classList.add("setting--hover"),setting_foldEvents.parentElement.classList.remove("setting--hover");break;case"avplay":this.selectedSetting="s365pseudo",setting_s365pseudo.parentElement.classList.add("setting--hover"),setting_avplay.parentElement.classList.remove("setting--hover");break;case"s365pseudo":break;default:this.selectedSetting="autoselect",setting_autoselect.parentElement.classList.add("setting--hover");};break;case tizen.tvinputdevice.getKey("Enter").code:switch(this.selectedSetting){case"autoselect":setting_autoselect.checked=!setting_autoselect.checked,localStorage.setItem("autoselect",setting_autoselect.checked),$settings.autoselect=setting_autoselect.checked;break;case"foldEvents":setting_foldEvents.checked=!setting_foldEvents.checked,localStorage.setItem("foldEvents",setting_foldEvents.checked),$settings.foldEvents=setting_foldEvents.checked;break;case"avplay":setting_avplay.checked=!setting_avplay.checked,localStorage.setItem("avplay",setting_avplay.checked),$settings.avplay=setting_avplay.checked;break;case"s365pseudo":setting_s365pseudo.checked=!setting_s365pseudo.checked,localStorage.setItem("s365pseudo",setting_s365pseudo.checked),$settings.s365pseudo=setting_s365pseudo.checked;};break;case tizen.tvinputdevice.getKey("Back").code:$schedule.reload(!1,e.reset);break;case tizen.tvinputdevice.getKey("ArrowLeft").code:c.focus();}},blur:function(){$schedule.list().currentEvent.classList.remove("event--hover")},reset:function(){list0.currentEvent=list0.querySelector(".event"),list0.currentEvent&&!schedule.classList.contains("schedule--menu")&&$schedule.list()===list0&&f.select(list0.currentEvent)}},f={previous:function(a){let b=a.previousElementSibling;for(;b&&!b.classList.contains("event");)b=b.previousElementSibling;return b},next:function(a){let b=a.nextElementSibling;for(;b&&!b.classList.contains("event");)b=b.nextElementSibling;return b},select:function(a,c){a.classList.add("event--hover"),a.parentElement.currentEvent=a,a.currentStream?g.select(a.currentStream,!0):b=a;const d=a.offsetParent;switch(c){case null:case"":break;case"top":d.scrollTop=a.offsetTop-a.firstElementChild.clientHeight;break;case"bottom":d.scrollTop=a.offsetTop-d.offsetHeight+a.offsetHeight+a.firstElementChild.clientHeight;break;case"center":d.scrollTop=a.offsetTop-(d.offsetHeight-a.clientHeight)/2;break;case"auto":default:const b=a.firstElementChild.clientHeight;a.offsetTop-b<d.scrollTop?d.scrollTop=a.offsetTop-b:a.offsetTop+a.clientHeight+b>d.scrollTop+d.clientHeight&&(d.scrollTop=a.offsetTop-d.offsetHeight+a.offsetHeight+b);}},refreshStreams:function(a){a.currentStream=null,$schedule.openEvent(a,b=>{if(!0===b){const b=a.querySelector(".stream");b&&g.select(b)}})},isOpen:a=>a.classList.contains("event--open"),onKey:function(b){b===tizen.tvinputdevice.getKey("ArrowLeft").code?(c.focus(),e.blur()):b===tizen.tvinputdevice.getKey("ArrowUp").code?function(){let a=f.previous(this);a&&(f.select(a),this.classList.remove("event--hover"))}.call(this):b===tizen.tvinputdevice.getKey("ArrowDown").code?function(){let a=f.next(this);a&&(f.select(a),this.classList.remove("event--hover"))}.call(this):b===tizen.tvinputdevice.getKey("Back").code?f.isOpen(this)?($schedule.closeEvent(this),this.currentStream=null):$schedule.closeSub()?e.focus(list0):document.documentElement.classList.contains("exit")?a():(document.documentElement.classList.add("exit"),setTimeout(()=>document.documentElement.classList.remove("exit"),1e3)):b===tizen.tvinputdevice.getKey("Enter").code?$schedule.openEvent(this,a=>{if(null!==a)if(!0===a){const a=this.querySelector(".stream");a&&g.select(a)}else list1.currentEvent=null,e.focus(list1),this.classList.remove("event--hover"),this.parentElement.currentEvent=this}):b===tizen.tvinputdevice.getKey("Info").code?f.isOpen(this)?f.refreshStreams(this):$schedule.reload(!0,e.reset):void 0}},g={parentEvent:a=>a.parentElement.parentElement.parentElement,select:function(a){const c=g.parentEvent(a);a.classList.add("stream--hover"),c.currentStream=a,$schedule.list().currentEvent===c&&(b=a);const d=parseInt(window.getComputedStyle(a,null).getPropertyValue("margin-left")),e=a.offsetParent,f=a.offsetWidth;a.offsetLeft-d-f<e.scrollLeft?e.scrollLeft=a.offsetLeft-d-f:a.offsetLeft+a.offsetWidth+d+f>e.scrollLeft+e.offsetWidth&&(e.scrollLeft=a.offsetLeft+a.offsetWidth+d+f-e.offsetWidth)},onKey:function(a){a===tizen.tvinputdevice.getKey("ArrowLeft").code?this.previousElementSibling?(this.classList.remove("stream--hover"),g.select(this.previousElementSibling)):(c.focus(),e.blur()):a===tizen.tvinputdevice.getKey("ArrowRight").code?this.nextElementSibling&&(this.classList.remove("stream--hover"),g.select(this.nextElementSibling)):a===tizen.tvinputdevice.getKey("ArrowUp").code?function(){const a=g.parentEvent(this);let b=f.previous(a);b&&(f.select(b),a.classList.remove("event--hover"))}.call(this):a===tizen.tvinputdevice.getKey("ArrowDown").code?function(){const a=g.parentEvent(this);let b=f.next(a);b&&(f.select(b),a.classList.remove("event--hover"))}.call(this):a===tizen.tvinputdevice.getKey("Back").code?function(){const a=g.parentEvent(this);$schedule.closeEvent(a),a.currentStream=null,b=a}.call(this):a===tizen.tvinputdevice.getKey("Enter").code?$schedule.openStream(this):a===tizen.tvinputdevice.getKey("Info").code?f.refreshStreams(g.parentEvent(this)):void 0}},h={onkey:function(a){a===tizen.tvinputdevice.getKey("ArrowRight").code||a===tizen.tvinputdevice.getKey("ArrowLeft").code||a===tizen.tvinputdevice.getKey("ArrowDown").code||a===tizen.tvinputdevice.getKey("Info").code?i.open(this):a===tizen.tvinputdevice.getKey("MediaStop").code||a===tizen.tvinputdevice.getKey("Back").code?($video.close(),e.focus($schedule.list())):a===tizen.tvinputdevice.getKey("MediaRewind").code||a===tizen.tvinputdevice.getKey("ChannelDown").code?this.previousStream():a===tizen.tvinputdevice.getKey("MediaFastForward").code||a===tizen.tvinputdevice.getKey("ChannelUp").code?this.nextStream():a===tizen.tvinputdevice.getKey("MediaPlay").code?this.isError()&&this.stream&&$video.play(this.stream):a===tizen.tvinputdevice.getKey("Enter").code?this.isError()&&this.stream?$video.play(this.stream):i.open(this):void 0}},i={open:function(a){b=a.videoBar.open(),b.player.stream&&i.selectStream(b.player.stream.streamBarObj,b)},selectStream:function(a,b){b.selectedStream&&b.selectedStream.classList.remove("video-stream--hover"),a.classList.add("video-stream--hover"),b.streamBar.scrollStreamIntoView(a.stream),b.selectedStream=a},onkey:function(a){a===tizen.tvinputdevice.getKey("ArrowRight").code?function(){if(this.selectedStream&&this.selectedStream.offsetParent){const a=this.selectedStream.nextSibling;a&&i.selectStream(a,this)}else if(this.player.stream&&this.player.stream.offsetParent)i.selectStream(this.player.stream.streamBarObj,this);else{const a=this.obj.querySelector(".video-stream");a&&i.selectStream(a,this)}}.call(this):a===tizen.tvinputdevice.getKey("ArrowLeft").code?function(){if(this.selectedStream&&this.selectedStream.offsetParent){const a=this.selectedStream.previousSibling;a&&i.selectStream(a,this)}else if(this.player.stream&&this.player.stream.offsetParent)i.selectStream(this.player.stream.streamBarObj,this);else{const a=this.obj.querySelector(".video-stream");a&&i.selectStream(a,this)}}.call(this):a===tizen.tvinputdevice.getKey("MediaPlay").code||a===tizen.tvinputdevice.getKey("Enter").code?this.selectedStream&&$video.play(this.selectedStream.stream):a===tizen.tvinputdevice.getKey("Back").code||a===tizen.tvinputdevice.getKey("ArrowUp").code?b=this.close():a===tizen.tvinputdevice.getKey("Info").code?this.refreshStreams(a=>{a&&i.selectStream(a.streamBarObj,this)}):a===tizen.tvinputdevice.getKey("MediaStop").code?($video.close(),e.focus($schedule.list())):a===tizen.tvinputdevice.getKey("MediaRewind").code||a===tizen.tvinputdevice.getKey("ChannelDown").code?(this.player.previousStream(),b=this.close()):a===tizen.tvinputdevice.getKey("MediaFastForward").code||a===tizen.tvinputdevice.getKey("ChannelUp").code?(this.player.nextStream(),b=this.close()):void 0}};return menuReload.onKey=d.onKey,menuDe.onKey=d.onKey,menuMain.onKey=d.onKey,menuFb.onKey=d.onKey,menuMore.onKey=d.onKey,menuAudio.onKey=d.onKey,menuGroup.onKey=d.onKey,menuSettings.onKey=d.onKey,list0.onKey=e.onKey,listSettings.onKey=e.settingsOnKey,{activateEvent:function(a){a.onKey=f.onKey},activateStream:function(a){a.onKey=g.onKey},activateStreamBarStream:function(){},activateVideoBar:function(a){a.onKey=i.onkey},activatePlayer:function(a){return a.extendVideoBar(),$settings.avplay?(a.video=document.createElement("object"),a.video.type="application/avplayer",a.open=function(b){webapis.avplay.stop(),webapis.avplay.open(b),webapis.avplay.setListener({onbufferingstart:function(){a.waiting()},onbufferingprogress:function(c){a.buffer(c)},onbufferingcomplete:function(){a.canplay()},onstreamcompleted:function(){webapis.avplay.stop(),a.error("Stream beendet")},onerror:function(b){webapis.avplay.stop(),a.error("Fehler: "+b)}}),webapis.avplay.setDisplayRect(0,0,1920,1080),webapis.avplay.prepareAsync(function(){webapis.avplay.play()},function(b){webapis.avplay.stop(),a.error("Fehler: "+b)})},a.close=function(){webapis.avplay.close()}):(a.video=document.createElement("video"),a.video.autoplay=!0,a.video.addEventListener("waiting",a.waiting),a.video.addEventListener("seeking",a.waiting),a.video.addEventListener("canplay",a.canplay),a.video.addEventListener("loadstart",a.waiting),a.video.addEventListener("ended",()=>a.error("Stream beendet")),a.video.addEventListener("stalled",a.waiting),a.video.addEventListener("progress",function(){if(a.isWaiting()&&0<a.video.duration)for(var b=0;b<a.video.buffered.length;b++)if(a.video.buffered.start(a.video.buffered.length-1-b)<=a.video.currentTime){a.buffer(100*(a.video.buffered.end(a.video.buffered.length-1-b)/a.video.duration));break}}),a.video.addEventListener("error",()=>{"error"in a.video&&null!==a.video.error&&("code"in a.video.error||"message"in a.video.error)?a.error("Fehler: "+("code"in a.video.error?"["+a.video.error.code+"] ":"")+(a.video.error.message||"")):a.error("Fehler: unbekannter Video-Error")}),a.open=function(b){a.video.src=b},a.close=function(){a.video.pause()}),a.video.className="video-player",a.container.appendChild(a.video),a.onKey=h.onkey,b=a,a},init:function(){document.body.addEventListener("keydown",function(a){null!==b&&b.onKey(a.keyCode),a.preventDefault()}),$schedule.init(localStorage.getItem("filter")||"fb",localStorage.getItem("audiofilter")||!1,localStorage.getItem("grouping")||!1,()=>{e.focus(list0)}),schedule.style.opacity="1",spinner.style.opacity="0",setTimeout(()=>spinner.remove(),1e3)}}}();const a="true"===localStorage.getItem("s365pseudo")?"s365_pseudo.js":"s365.min.js";importFiles({js:[$srcUrl+"share.min.js",$srcUrl+a],css:[$srcUrl+"share.min.css",$srcUrl+"tizen.min.css"]},()=>$device.init())}
