//v1.0.1
var $device=null;const $settings={autoselect:!0,vMinEvents:7,vNum:2,foldEvents:!0,s365pseudo:!1};function start(){(function(){const a=document.createElement("div");a.id="schedule",a.className="schedule",a.style.opacity="0",a.innerHTML="<div class=\"schedule-hamburger\"><span class=\"hamburger-icon\" id=\"hamburger\"></span><span class=\"hamburger-filter\"></span><span class=\"hamburger-audio_group\"></span></div><div class=\"schedule-dimmer\" id=\"dimmer\"></div><div class=\"schedule-menu\" id=\"menu\"><div class=\"menu-item menu-item--reload\" id=\"menuReload\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--de\" id=\"menuDe\"></div><div class=\"menu-item menu-item--main\" id=\"menuMain\"></div><div class=\"menu-item menu-item--fb\" id=\"menuFb\"></div><div class=\"menu-item menu-item--more\" id=\"menuMore\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--audio\" id=\"menuAudio\"></div><div class=\"menu-item menu-item--group\" id=\"menuGroup\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--settings\" id=\"menuSettings\"></div></div><div class=\"schedule-list\" id=\"list0\"></div><div class=\"schedule-list\" id=\"list1\"></div><div class=\"schedule-list\" id=\"listSettings\"><div class=\"setting\"><input type=\"checkbox\""+($settings.autoselect?" checked":"")+" id=\"setting_autoselect\"><label for=\"setting_autoselect\">Streams automatisch ausw\xE4hlen</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.foldEvents?" checked":"")+" id=\"setting_foldEvents\"><label for=\"setting_foldEvents\">Sprachen zu Untermen\xFCs zusammenfassen</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.s365pseudo?" checked":"")+" id=\"setting_s365pseudo\"><label for=\"setting_s365pseudo\">s365-Test (Neustart notwendig)</label></div></div></div>",document.body.appendChild(a)})(),$device=function(){var a=!1,b=window.matchMedia("(orientation:portrait)");const c=function(){schedule.classList.add("schedule--menu"),a=!0},d=function(){schedule.classList.remove("schedule--menu"),a=!1};hamburger.onclick=c,dimmer.onclick=d,menu.onpointerenter=function(d){a||b.matches||(menu.touched="touch"===d.pointerType)||c()},menu.onpointerleave=function(a){b.matches||"touch"===a.pointerType||d()},menu.onclick=function(){menu.touched&&!a&&c()},schedule.onpointerdown=function(f){if("touch"!==f.pointerType)return;let g=0,h=0,i=!1,j=-1,k=0,l=0,m=!1;const n=function(c){"touch"===c.pointerType&&-1===j&&(g=parseFloat(getComputedStyle(schedule,null).fontSize),h=16*g,(a||c.clientX<(4-2*b.matches)*g)&&(l=c.clientX,j=c.pointerId,schedule.onpointermove=pointermove,schedule.onpointerup=o,schedule.onpointercancel=o))},o=function(a){j===a.pointerId&&(m&&(a.clientX-l>h/2?c():d(),menu.style.left=null,menu.style.width=null,dimmer.style.opacity=null,schedule.classList.remove("--menuMove"),schedule.releasePointerCapture(a.pointerId),m=!1),schedule.onpointermove=null,schedule.onpointerup=null,schedule.onpointercancel=null,j=-1)};pointermove=function(b){if(j===b.pointerId)if(m){if(k=b.clientX,i)return;window.requestAnimationFrame(swipe),i=!0}else Math.abs(b.clientX-l)>20&&(schedule.setPointerCapture(b.pointerId),m=!0,schedule.classList.add("--menuMove"),l=a?Math.min(b.clientX-h,0):b.clientX)},swipe=function(){if(m&&i){const a=Math.max(0,Math.min((k-l)/h,1));b.matches?menu.style.left=-(h*(1-a))+"px":menu.style.width=h*a+"px",dimmer.style.opacity=a/10}i=!1},schedule.onpointerdown=n,n(f)};const e=function(a,b){let c=-1;a.addEventListener("pointerdown",function(d){if("touch"!==d.pointerType||-1!==c)return;c=d.pointerId,a.setPointerCapture(c);const f=d.clientX,e=function(a){a.pointerId!==c||(200<Math.abs(a.clientX-f)&&b(),g(a))},g=function(b){b.pointerId!==c||(c=-1,a.releasePointerCapture(b.pointerId),a.onpointercancel=null,a.onpointerup=null)};a.onpointercancel=g,a.onpointerup=e})};e(list1,()=>$schedule.closeSub()),e(listSettings,()=>$schedule.reload(!1));const f=function(b,c){b.onpointerenter=function(){b.classList.add("menu-item--hover")},b.onpointerleave=function(){b.classList.remove("menu-item--hover")},b.onpointerdown=function(a){b.touched="touch"===a.pointerType},b.onclick=function(){a&&(c(),b.touched&&d())}};return f(menuReload,()=>$schedule.reload(!0)),f(menuDe,()=>chrome.storage.local.set({filter:$schedule.setFilter("de")})),f(menuMain,()=>chrome.storage.local.set({filter:$schedule.setFilter("main")})),f(menuFb,()=>chrome.storage.local.set({filter:$schedule.setFilter("fb")})),f(menuMore,()=>chrome.storage.local.set({filter:$schedule.setFilter("more")})),f(menuAudio,()=>chrome.storage.local.set({audiofilter:$schedule.toggleAudiofilter()})),f(menuGroup,()=>chrome.storage.local.set({grouping:$schedule.toggleGrouping()})),f(menuSettings,function(){schedule.classList.contains("schedule--settings")||$schedule.openSettings()}),{activateEvent:function(a){const b=a.firstChild;b.onclick=function(b){b.shiftKey?$schedule.closeEvent(a):$schedule.openEvent(a)},b.oncontextmenu=function(b){$schedule.closeEvent(a),b.preventDefault()},a.onpointerenter=function(){this.classList.add("event--hover")},a.onpointerleave=function(a){this.classList.remove("event--hover"),this.classList.toggle("event--touched","touch"===a.pointerType)}},activateStream:function(a){a.onclick=function(){$schedule.openStream(a)},a.onpointerenter=function(){this.classList.add("stream--hover")},a.onpointerleave=function(){this.classList.remove("stream--hover")}},activateVideoBar:function(a){a.obj.onpointerenter=function(b){"touch"!==b.pointerType&&a.open()},a.obj.onpointerleave=function(b){"touch"!==b.pointerType&&a.close()},a.obj.onpointerdown=function(b){if("touch"!==b.pointerType)return;let c,d,f,g,h,i=!1,j=-1;const k=function(b){"touch"===b.pointerType&&-1===j&&(c=a.obj.offsetHeight,h=null,d=!1,j=b.pointerId,a.obj.setPointerCapture(j),f=b.clientY)},l=function(b){b.pointerId===j&&(d&&(null!==h&&(.5<h?a.open():a.close()),a.obj.style.bottom=null,a.obj.style.opacity=null,a.obj.classList.remove("video-bar--touchMove"),d=!1),a.obj.releasePointerCapture(j),j=-1)},m=function(){d&&(h=Math.max(0,Math.min((f-g)/c,1)),a.obj.style.bottom=c*(h-1)+"px",a.obj.style.opacity=h),i=!1};a.obj.onpointerdown=k,a.obj.onpointermove=function(b){if(b.pointerId===j)if(d){if(g=b.clientY,i)return;i=!0,window.requestAnimationFrame(m)}else Math.abs(f-b.clientY)>20&&(d=!0,f=b.clientY+a.isOpen()*c,a.obj.classList.add("video-bar--touchMove"))},a.obj.onpointerup=l,a.obj.onpointercancel=l,k(b)};const b=document.createElement("div");b.innerHTML="&#xe800;",b.className="video-bar-reload",b.onclick=function(){a.refreshStreams()},a.obj.appendChild(b)},activateStreamBarStream:function(a){a.onclick=function(){$video.play(this.stream)},a.onpointerenter=function(){this.classList.add("video-stream--hover")},a.onpointerleave=function(){this.classList.remove("video-stream--hover")}},activatePlayer:function(a){"function"==typeof Hls&&Hls.isSupported()?(a.extendVideoBar(),Hls.onHlsError=function(b,c){const d=(c.fatal?"Schwerer ":"")+(c.type===Hls.ErrorTypes.NETWORK_ERROR?"Netzwerkfehler (":c.type===Hls.ErrorTypes.MEDIA_ERROR?"Medienfehler (":c.type===Hls.ErrorTypes.MUX_ERROR?"Mux-Fehler (":c.type===Hls.ErrorTypes.OTHER_ERROR?"Fehler (":"Unbekannter Fehler (")+c.details+")!";c.fatal&&(a.error(d),a.hls.destroy())},Hls.onHlsFragLoadProgress=function(b,c){a.isWaiting()&&a.buffer(100*(c.stats.loaded/c.stats.total))},a.video=document.createElement("video"),a.video.autoplay=!0,a.video.poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",a.video.addEventListener("waiting",a.waiting),a.video.addEventListener("seeking",a.waiting),a.video.addEventListener("canplay",a.canplay),a.video.addEventListener("loadstart",a.waiting),a.video.addEventListener("ended",()=>a.error("Stream beendet")),a.video.addEventListener("stalled",a.waiting),a.video.addEventListener("error",()=>{"error"in a.video&&null!==a.video.error&&("code"in a.video.error||"message"in a.video.error)?a.error("Fehler: "+("code"in a.video.error?"["+a.video.error.code+"] ":"")+(a.video.error.message||"")):a.error("Fehler: unbekannter Video-Error")}),a.open=function(b){a.hls&&(a.hls.destroy(),a.hls.bufferTimer&&(clearInterval(a.hls.bufferTimer),a.hls.bufferTimer=void 0),a.hls=null),a.hls=new Hls,a.hls.on(Hls.Events.ERROR,Hls.onHlsError),a.hls.on(Hls.Events.FRAG_LOAD_PROGRESS,Hls.onHlsFragLoadProgress),a.hls.loadSource(b),a.hls.attachMedia(a.video)},a.close=()=>{a.hls&&(a.hls.destroy(),a.hls.bufferTimer&&(clearInterval(a.hls.bufferTimer),a.hls.bufferTimer=void 0),a.hls=null)},a.video.className="video-player",a.container.appendChild(a.video),a.container.onpointerdown=function(b){if("touch"!==b.pointerType)return;let c,d,f=-1;const g=200,e=function(b){-1===f&&"touch"===b.pointerType&&b.target===a.container&&(a.container.setPointerCapture(f=b.pointerId),d=b.clientY,c=b.clientX)},h=function(b){b.pointerId===f&&(c-=b.clientX,d=Math.abs(b.clientY-d),d<.1*Math.abs(c)&&(c-=b.clientX,-c>g?a.nextStream():c>g&&a.previousStream()),f=-1,a.container.releasePointerCapture(b.pointerId))};a.container.onpointerdown=e,a.container.onpointerup=h,a.container.onpointercancel=h,e(b)},a.container.onclick=function(){a.videoBar.isOpen()&&a.videoBar.close()}):(a.video=null,a.close=()=>{},a.error("HLS nicht unterst\xFCtzt"));const b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div");b.className="video-btn video-back",c.className="video-btn video-volume",d.className="video-btn video-fullscreen",a.container.appendChild(b),a.container.appendChild(c),a.container.appendChild(d),b.onclick=$video.close,d.onclick=function(){document.webkitIsFullScreen?document.webkitExitFullscreen():a.container.webkitRequestFullscreen()},c.onclick=function(){a.video.muted=c.classList.toggle("video-volume--muted",!a.video.muted)};let e=null;const f=function(){a.container.classList.add("fadeout"),clearTimeout(e)},g=function(){a.container.classList.remove("fadeout"),clearTimeout(e),e=setTimeout(f,3000)};return a.container.addEventListener("pointermove",g),g(),a},init:function(b){document.body.addEventListener("keydown",function(b){switch(b.keyCode){case 34:$video.isOpen()&&$video.getPlayer().previousStream();break;case 33:case 13:$video.isOpen()&&$video.getPlayer().nextStream();break;case 8:case 27:case 46:if($video.isOpen()){const a=$video.getPlayer();8===b.keyCode?a.previousStream():a.videoBar.isOpen()?a.videoBar.close():$video.close()}else if(a)d();else if(schedule.classList.contains("schedule--settings"))$schedule.reload(!1);else if($schedule.closeSub());}});const c=function(a,b){a.onclick=function(){chrome.storage.local.set({[b]:a.checked}),$settings[b]=a.checked},a.checked=$settings[b]};c(setting_foldEvents,"foldEvents"),c(setting_autoselect,"autoselect"),c(setting_s365pseudo,"s365pseudo"),$schedule.init(b.filter,b.audiofilter,b.grouping),schedule.style.opacity="1",spinner.style.opacity="0",setTimeout(()=>{spinner.remove(),document.body.style.background="#f0f0f0"},1e3)}}}(),chrome.storage.local.get({autoselect:$settings.autoselect,foldEvents:$settings.foldEvents,s365pseudo:$settings.s365pseudo,filter:"fb",audiofilter:!1,grouping:!1},function(a){$settings.autoselect=a.autoselect,$settings.foldEvents=a.foldEvents,$settings.s365pseudo=a.s365pseudo;let b=[$srcUrl+"share.min.js",$deviceUrl+"lib/hls.light.min.js"];!0===a.s365pseudo?b.push($srcUrl+"s365_pseudo.js"):b.push($srcUrl+"s365.min.js"),importFiles({js:b,css:[$srcUrl+"share.min.css",$srcUrl+"addon.min.css"]},()=>$device.init(a))})}
