//v2.0
var $device=null;const $settings={autoselect:"false"!==localStorage.getItem("autoselect"),vMinEvents:7,vNum:2,foldEvents:"false"!==localStorage.getItem("foldEvents"),exoplayer:"false"!==localStorage.getItem("exoplayer"),s365pseudo:"true"===localStorage.getItem("s365pseudo")||!1};function start(){(function(){const a=document.createElement("div");a.id="schedule",a.className="schedule",a.style.opacity="0",a.innerHTML="<div class=\"schedule-hamburger\"><span class=\"hamburger-icon\" id=\"hamburger\"></span><span class=\"hamburger-filter\"></span><span class=\"hamburger-audio_group\"></span></div><div class=\"schedule-dimmer\" id=\"dimmer\"></div><div class=\"schedule-menu\" id=\"menu\"><div class=\"menu-item menu-item--reload\" id=\"menuReload\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--de\" id=\"menuDe\"></div><div class=\"menu-item menu-item--main\" id=\"menuMain\"></div><div class=\"menu-item menu-item--fb\" id=\"menuFb\"></div><div class=\"menu-item menu-item--more\" id=\"menuMore\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--audio\" id=\"menuAudio\"></div><div class=\"menu-item menu-item--group\" id=\"menuGroup\"></div><div class=\"menu-seperator\"></div><div class=\"menu-item menu-item--settings\" id=\"menuSettings\"></div></div><div class=\"schedule-list\" id=\"list0\"></div><div class=\"schedule-list\" id=\"list1\"></div><div class=\"schedule-list\" id=\"listSettings\"><div class=\"setting\"><input type=\"checkbox\""+($settings.autoselect?" checked":"")+" id=\"setting_autoselect\"><label for=\"setting_autoselect\">Streams automatisch ausw\xE4hlen</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.foldEvents?" checked":"")+" id=\"setting_foldEvents\"><label for=\"setting_foldEvents\">Sprachen zu Untermen\xFCs zusammenfassen</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.exoplayer?" checked":"")+" id=\"setting_exoplayer\"><label for=\"setting_exoplayer\">ExoPlayer f\xFCr Wiedergabe benutzen (erst nach Neustart der App)</label></div><div class=\"setting\"><input type=\"checkbox\""+($settings.s365pseudo?" checked":"")+" id=\"setting_s365pseudo\"><label for=\"setting_s365pseudo\">s365-Test (Neustart notwendig)</label></div></div></div><div class=\"msg-exit\"></div>",document.body.appendChild(a)})(),$device=function(){var a=!1,b=window.matchMedia("(orientation:portrait)");const c=function(){schedule.classList.add("schedule--menu"),a=!0},d=function(){schedule.classList.remove("schedule--menu"),a=!1};hamburger.onclick=c,dimmer.onclick=d,menu.onpointerenter=function(d){a||b.matches||(menu.touched="touch"===d.pointerType)||c()},menu.onpointerleave=function(a){b.matches||"touch"===a.pointerType||d()},menu.onclick=function(){menu.touched&&!a&&c()},schedule.onpointerdown=function(f){if("touch"!==f.pointerType)return;let g=0,h=0,i=!1,j=-1,k=0,l=0,m=!1;const n=function(c){"touch"===c.pointerType&&-1===j&&(g=parseFloat(getComputedStyle(schedule,null).fontSize),h=16*g,(a||c.clientX<(4-2*b.matches)*g)&&(l=c.clientX,j=c.pointerId,schedule.onpointermove=pointermove,schedule.onpointerup=o,schedule.onpointercancel=o))},o=function(a){j===a.pointerId&&(m&&(a.clientX-l>h/2?c():d(),menu.style.left=null,menu.style.width=null,dimmer.style.opacity=null,schedule.classList.remove("--menuMove"),schedule.releasePointerCapture(a.pointerId),m=!1),schedule.onpointermove=null,schedule.onpointerup=null,schedule.onpointercancel=null,j=-1)};pointermove=function(b){if(j===b.pointerId)if(m){if(k=b.clientX,i)return;window.requestAnimationFrame(swipe),i=!0}else Math.abs(b.clientX-l)>20&&(schedule.setPointerCapture(b.pointerId),m=!0,schedule.classList.add("--menuMove"),l=a?Math.min(b.clientX-h,0):b.clientX)},swipe=function(){if(m&&i){const a=Math.max(0,Math.min((k-l)/h,1));b.matches?menu.style.left=-(h*(1-a))+"px":menu.style.width=h*a+"px",dimmer.style.opacity=a/10}i=!1},schedule.onpointerdown=n,n(f)};const e=function(a,b){const d=b?"clientX":"clientY";a.addEventListener("pointerdown",function(a){if("mouse"!==a.pointerType)return;a.preventDefault();const e=this;let f=a[d],g=a[d],h=!1,i=!1;const j=function(b){b.pointerId===a.pointerId&&(e.onpointermove=null,e.onpointerup=null,e.onpointercancel=null,i&&(e.classList.remove("scrll"),e.releasePointerCapture(b.pointerId)))},k=function(){h&&(b?e.scrollBy(f-g,0):e.scrollBy(0,f-g),f=g),h=!1};e.onpointermove=function(b){if(b.pointerId===a.pointerId){if(g=b[d],h)return;i?(h=!0,window.requestAnimationFrame(k)):Math.abs(f-g)>10&&(f=g,e.classList.add("scrll"),e.setPointerCapture(b.pointerId),i=!0)}},e.onpointerup=j,e.onpointercancel=j})};e(list0,!1),e(list1,!1);const f=function(a,b){let c=-1;a.addEventListener("pointerdown",function(d){if("touch"!==d.pointerType||-1!==c)return;c=d.pointerId,a.setPointerCapture(c);const f=d.clientX,e=function(a){a.pointerId!==c||(200<Math.abs(a.clientX-f)&&b(),g(a))},g=function(b){b.pointerId!==c||(c=-1,a.releasePointerCapture(b.pointerId),a.onpointercancel=null,a.onpointerup=null)};a.onpointercancel=g,a.onpointerup=e})};f(list1,()=>$schedule.closeSub()),f(listSettings,()=>$schedule.reload(!1));const g=function(b,c){b.onpointerenter=function(){b.classList.add("menu-item--hover")},b.onpointerleave=function(){b.classList.remove("menu-item--hover")},b.onpointerdown=function(a){b.touched="touch"===a.pointerType},b.onclick=function(){a&&(c(),b.touched&&d())}};g(menuReload,()=>$schedule.reload(!0)),g(menuDe,()=>localStorage.setItem("filter",$schedule.setFilter("de"))),g(menuMain,()=>localStorage.setItem("filter",$schedule.setFilter("main"))),g(menuFb,()=>localStorage.setItem("filter",$schedule.setFilter("fb"))),g(menuMore,()=>localStorage.setItem("filter",$schedule.setFilter("more"))),g(menuAudio,()=>localStorage.setItem("audiofilter",$schedule.toggleAudiofilter())),g(menuGroup,()=>localStorage.setItem("grouping",$schedule.toggleGrouping())),g(menuSettings,function(){schedule.classList.contains("schedule--settings")||$schedule.openSettings()});const h=function(a,b){a.onclick=function(){localStorage.setItem(b,a.checked),$settings[b]=a.checked},a.checked=$settings[b]};h(setting_exoplayer,"exoplayer"),h(setting_foldEvents,"foldEvents"),h(setting_autoselect,"autoselect"),h(setting_s365pseudo,"s365pseudo");const i=function(){if($video.isOpen()){if(!0===$settings.exoplayer)$video.close();else{const a=$video.getPlayer();a.videoBar.isOpen()?a.videoBar.close():(AndroidFullScreen.showSystemUI(),$video.close())}}else if(a)d();else if(schedule.classList.contains("schedule--settings"))$schedule.reload(!1);else if($schedule.closeSub());else document.documentElement.classList.contains("exit")?navigator.app.exitApp():(document.documentElement.classList.add("exit"),setTimeout(()=>document.documentElement.classList.remove("exit"),1e3));return!1};return document.addEventListener("backbutton",i),{activateEvent:function(a){const b=a.firstChild;b.onclick=function(b){b.shiftKey?$schedule.closeEvent(a):$schedule.openEvent(a)},b.oncontextmenu=function(b){$schedule.closeEvent(a),b.preventDefault()},a.onpointerenter=function(){this.classList.add("event--hover")},a.onpointerleave=function(a){this.classList.remove("event--hover"),this.classList.toggle("event--touched","touch"===a.pointerType)}},activateStream:function(a){a.onclick=function(){$schedule.openStream(a)},a.onpointerenter=function(){this.classList.add("stream--hover")},a.onpointerleave=function(){this.classList.remove("stream--hover")}},activateVideoBar:function(a){a.obj.onpointerenter=function(b){"touch"!==b.pointerType&&a.open()},a.obj.onpointerleave=function(b){"touch"!==b.pointerType&&a.close()},a.obj.onpointerdown=function(b){if("touch"!==b.pointerType)return;let c,d,f,g,h,i=!1,j=-1;const k=function(b){"touch"===b.pointerType&&-1===j&&(c=a.obj.offsetHeight,h=null,d=!1,j=b.pointerId,a.obj.setPointerCapture(j),f=b.clientY)},l=function(b){b.pointerId===j&&(d&&(null!==h&&(.5<h?a.open():a.close()),a.obj.style.bottom=null,a.obj.style.opacity=null,a.obj.classList.remove("video-bar--touchMove"),d=!1),a.obj.releasePointerCapture(j),j=-1)},m=function(){d&&(h=Math.max(0,Math.min((f-g)/c,1)),a.obj.style.bottom=c*(h-1)+"px",a.obj.style.opacity=h),i=!1};a.obj.onpointerdown=k,a.obj.onpointermove=function(b){if(b.pointerId===j)if(d){if(g=b.clientY,i)return;i=!0,window.requestAnimationFrame(m)}else Math.abs(f-b.clientY)>20&&(d=!0,f=b.clientY+a.isOpen()*c,a.obj.classList.add("video-bar--touchMove"))},a.obj.onpointerup=l,a.obj.onpointercancel=l,k(b)},e(a.streamBar.obj,!0);const b=document.createElement("div");b.innerHTML="&#xe800;",b.className="video-bar-reload",b.onclick=function(){a.refreshStreams()},a.obj.appendChild(b)},activateStreamBarStream:function(a){a.onclick=function(){$video.play(this.stream)},a.onpointerenter=function(){this.classList.add("video-stream--hover")},a.onpointerleave=function(){this.classList.remove("video-stream--hover")}},activatePlayer:function(a){const b=function(b){if("touch"!==b.pointerType)return;let c,d,f=-1;const g=200,e=function(b){-1===f&&"touch"===b.pointerType&&b.target===a.container&&(a.container.setPointerCapture(f=b.pointerId),d=b.clientY,c=b.clientX)},h=function(b){b.pointerId===f&&(c-=b.clientX,d=Math.abs(b.clientY-d),d<.1*Math.abs(c)&&(c-=b.clientX,-c>g?a.nextStream():c>g&&a.previousStream()),f=-1,a.container.releasePointerCapture(b.pointerId))};a.container.onpointerdown=e,a.container.onpointerup=h,a.container.onpointercancel=h,e(b)};if($settings.exoplayer){const c=function(b){if("KEY_EVENT"===b.eventType)"ACTION_DOWN"===b.eventAction&&("KEYCODE_BACK"==b.eventKeycode?setTimeout(()=>$video.close(),100):"KEYCODE_SPACE"==b.eventKeycode||"KEYCODE_ENTER"==b.eventKeycode?window.ExoPlayer.showController():"KEYCODE_DPAD_LEFT"==b.eventKeycode||"KEYCODE_DPAD_DOWN"==b.eventKeycode||"KEYCODE_PAGE_DOWN"==b.eventKeycode?a.previousStream():("KEYCODE_DPAD_RIGHT"==b.eventKeycode||"KEYCODE_DPAD_UP"==b.eventKeycode||"KEYCODE_PAGE_UP"==b.eventKeycode)&&a.nextStream());else if("TOUCH_EVENT"==b.eventType)if(window.ExoPlayer.showController(),"ACTION_DOWN"===b.eventAction)e.x=b.eventAxisX,e.y=b.eventAxisY;else if("ACTION_UP"===b.eventAction){const c=Math.abs(e.y-b.eventAxisY),d=Math.abs(e.x-b.eventAxisX);500<d&&c<d/10&&(e.x>b.eventAxisX?a.previousStream():a.nextStream())}},d=function(b){window.ExoPlayer.close(),a.error(b.errorMessage||"unbekannter Fehler")},e={x:0,y:0};a.close=window.ExoPlayer.close,a.open=function(b){const e=a.event.time+" - "+a.broadcast.lang+" - Stream "+(a.stream.id+1);a.canplay(),window.ExoPlayer.getState(f=>{"STATE_ENDED"===f.playbackState?window.ExoPlayer.show({url:b,controller:{streamTitle:a.event.title,streamDescription:e,hideProgress:!0}},c,d):window.ExoPlayer.setStream(b,{streamTitle:a.event.title,streamDescription:e,hideProgress:!0})},()=>{window.ExoPlayer.show({url:b,controller:{streamTitle:a.event.title,streamDescription:e,hideProgress:!0}},c,d)})},a.container.onpointerdown=b}else"function"==typeof Hls&&Hls.isSupported()?(a.extendVideoBar(),Hls.onHlsError=function(b,c){const d=(c.fatal?"Schwerer ":"")+(c.type===Hls.ErrorTypes.NETWORK_ERROR?"Netzwerkfehler (":c.type===Hls.ErrorTypes.MEDIA_ERROR?"Medienfehler (":c.type===Hls.ErrorTypes.MUX_ERROR?"Mux-Fehler (":c.type===Hls.ErrorTypes.OTHER_ERROR?"Fehler (":"Unbekannter Fehler (")+c.details+")!";c.fatal&&(a.error(d),a.hls.destroy())},Hls.onHlsFragLoadProgress=function(b,c){a.isWaiting()&&a.buffer(100*(c.stats.loaded/c.stats.total))},a.video=document.createElement("video"),a.video.autoplay=!0,a.video.poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",a.video.addEventListener("waiting",a.waiting),a.video.addEventListener("seeking",a.waiting),a.video.addEventListener("canplay",a.canplay),a.video.addEventListener("loadstart",a.waiting),a.video.addEventListener("ended",()=>a.error("Stream beendet")),a.video.addEventListener("stalled",a.waiting),a.video.addEventListener("error",()=>{"error"in a.video&&null!==a.video.error&&("code"in a.video.error||"message"in a.video.error)?a.error("Fehler: "+("code"in a.video.error?"["+a.video.error.code+"] ":"")+(a.video.error.message||"")):a.error("Fehler: unbekannter Video-Error")}),a.open=function(b){a.hls&&(a.hls.destroy(),a.hls.bufferTimer&&(clearInterval(a.hls.bufferTimer),a.hls.bufferTimer=void 0),a.hls=null),a.hls=new Hls,a.hls.on(Hls.Events.ERROR,Hls.onHlsError),a.hls.on(Hls.Events.FRAG_LOAD_PROGRESS,Hls.onHlsFragLoadProgress),a.hls.loadSource(b),a.hls.attachMedia(a.video)},a.close=()=>{a.hls&&(a.hls.destroy(),a.hls.bufferTimer&&(clearInterval(a.hls.bufferTimer),a.hls.bufferTimer=void 0),a.hls=null)},a.video.className="video-player",a.container.appendChild(a.video),a.container.onpointerdown=b,a.container.onclick=function(){a.videoBar.isOpen()&&a.videoBar.close()},AndroidFullScreen.immersiveMode()):(a.video=null,a.close=()=>{},a.error("HLS nicht unterst\xFCtzt"));return a},init:function(){document.body.addEventListener("keydown",function(a){switch(a.keyCode){case 37:case 40:case 34:$video.isOpen()&&$video.getPlayer().previousStream();break;case 38:case 39:case 33:$video.isOpen()&&$video.getPlayer().nextStream();}}),$schedule.init(localStorage.getItem("filter")||"fb",localStorage.getItem("audiofilter")||!1,localStorage.getItem("grouping")||!1),schedule.style.opacity="1",spinner.style.opacity="0",setTimeout(()=>{spinner.remove(),document.body.style.background="#f0f0f0"},1e3)}}}(),function(){let a=[$srcUrl+"share.min.js"];"false"===localStorage.getItem("exoplayer")&&a.push($deviceUrl+"lib/hls.light.min.js"),"true"===localStorage.getItem("s365pseudo")?a.push($srcUrl+"s365_pseudo.js"):a.push($srcUrl+"s365.min.js"),importFiles({js:a,css:[$srcUrl+"share.min.css",$srcUrl+"android.min.css"]},()=>$device.init())}()}
