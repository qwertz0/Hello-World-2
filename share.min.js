//v1.0
const $schedule=function(){function a(a,b,c,d){null===c&&(c=document.getElementById(a.id+"~"+b.id));let f=null;if(!1===$settings.autoselect&&c){c.loading=!0,c.classList.add("event--loading"),c.classList.add("event--open"),f=c.children[1],f.innerHTML="<span class='event-streams'></span><div class='spinner event-spinner'></div>";const a=parseInt(window.getComputedStyle(c,null).getPropertyValue("margin-bottom"));c.offsetTop+c.clientHeight+a>j.scrollTop+j.clientHeight-j.offsetTop&&(j.scrollTop=c.offsetTop-j.offsetHeight+j.offsetTop+c.offsetHeight+a)}$s365.getLinks(b.url).then(e=>{if(i.some(b=>b===a)){const g=b.streams||[];if(b.streams=e.map((a,b)=>({url:a,id:b,played:(g.find(b=>b.url===a)||{}).played||!1})),f&&null!==c.offsetParent){const d=f.firstChild;b.streams.forEach((c,e)=>{const f=document.createElement("span");f.stream=c,f.innerHTML=e+1,f.id=a.id+"~"+b.id+"~"+c.id,c.streamObj=f,f.className="stream"+(c.played?" stream--played":""),d.appendChild(f),$device.activateStream(f)}),c.classList.remove("event--loading"),c.loading=!1}d(!0,b.streams)}else d(null,null)}).catch(a=>{f&&null!==c.offsetParent?(null===a?c.classList.remove("event--open"):(console.log("FEHLER",a),f.firstChild.innerHTML="Fehler beim Laden!"),c.classList.remove("event--loading"),c.loading=!1):null!==a&&console.log("FEHLER",a),d(!(null!==a)&&null,a)})}function b(){return j!==list0&&(j=list0,schedule.classList.remove("schedule--sub","schedule--settings"),!0)}function c(a){const b=document.createElement("div");return b.className="list-seperator",b.innerHTML=a,j.appendChild(b),b}function d(a,b){const c=document.createElement("div"),d="number"==typeof a.away;if("undefined"==typeof b&&(b=1===a.langs.length?a.langs[0]:a),c.className="event"+(b.online?" event--online":"")+(b.de?" event--german":"")+(b.en?" event--english":""),c.event=a,b.lang?(c.id=a.id+"~"+b.id,c.broadcast=b):(a.id=a.id,c.broadcast=null),c.innerHTML="<div class=\"event-header\"><div class=\"event-time\">"+a.time+"</div><div class=\"event-label\"><div class=\"event-title\">"+a.title+"</div><div class=\"event-league\">"+a.sub+"</div></div><div class=\"event-logos\"></div><div class=\"event-lang\"><span>"+(b.lang||"Multilingual")+"</span></div></div><div class=\"event-content\"></div>","number"==typeof a.home){const b=c.firstChild.children[2],d=document.createElement("div");if(d.style.backgroundImage="url("+$deviceUrl+"logos/"+a.home+".svg)",b.appendChild(d),"number"==typeof a.away){const c=document.createElement("div");c.style.backgroundImage="url("+$deviceUrl+"logos/"+a.away+".svg)",b.appendChild(c)}}return j.appendChild(c),$device.activateEvent(c),c}function e(a){j=list1,schedule.classList.add("schedule--sub"),list1.innerHTML="<div id=\"listSpinner\" class=\"spinner schedule-spinner\"></div>",list1.classList.add("schedule-list--loading");const b=c(a.title);let e=!1;a.langs.forEach(b=>{e=e||b.online,d(a,b)}),e&&b.classList.add("list-seperator--online"),list1.classList.remove("schedule-list--loading")}function h(a,e,f,h){h="function"==typeof h?h:function(){},i=[],b(),list0.innerHTML="<div id=\"listSpinner\" class=\"spinner schedule-spinner\"></div>",list0.removeAttribute("text"),list0.classList.add("schedule-list--loading"),$s365.getEvents("more"!==a,e).then(b=>{if(console.log(b),"de"===a?b=b.filter(a=>!0===a.nat):"main"==a&&(b=b.filter(a=>5>a.cat)),0<b.length){f?b.sort((c,a)=>{if(c.cat!==a.cat)return c.cat-a.cat;if(7===c.cat){const b=c.sport.toLowerCase(),d=a.sport.toLowerCase();return b===d?c.i-a.i:b>d?1:-1}return c.i-a.i}).forEach(a=>{a.group=7===a.cat?a.sport:["1. Bundesliga","2. Bundesliga","DFB Pokal","UEFA Champions League","UEFA Europa League","Fu\xDFball (sonstiges)","?","","?","Sonstiges"][a.cat]}):b.forEach(a=>{a.group=parseInt(a.time.substr(0,a.time.indexOf(":")))+":00"});let a=[];if(b.length>$settings.vMinEvents&&0<$settings.vNum){let c=[];b.forEach((a,b)=>{c[b]=a.online?"number"==typeof a.home?"number"==typeof a.away?Math.min(a.home,a.away):40===a.home?1:a.home:"number"==typeof a.away?a.away:a.nat?a.de?96:a.en?97:98:a.de?99:1/0:1/0});for(let d,e,f,g=0;g<$settings.vNum&&(d=Math.min(...c),d!==1/0);g++)e=c.indexOf(d),c[e]=1/0,f=Object.assign({},b[e]),$settings.foldEvents||(f.langs=[f.langs[0]]),f.id="_"+b[e].id,f.group="Vorschl\xE4ge",a.push(f)}i=a.concat(b);let e="",g=!1,j=null;i.forEach(a=>{e===a.group?g=g||a.online:(g&&j.classList.add("list-seperator--online"),j=c(e=a.group),g=a.online),!0===$settings.foldEvents?d(a):a.langs.forEach(b=>d(a,b))}),g&&j.classList.add("list-seperator--online"),list0.classList.remove("schedule-list--loading"),h(!0)}else list0.classList.remove("schedule-list--loading"),list0.setAttribute("text",""),h(!0)}).catch(a=>{null===a?h(null):(console.log("FEHLER:",a),list0.setAttribute("text",a),list0.classList.remove("schedule-list--loading"),h(!1,a))})}let i=[],j=list0;return{setFilter:function(a,b){return schedule.setAttribute("filter",a),h(a,schedule.classList.contains("schedule--audiofilter"),schedule.classList.contains("schedule--group"),b),a},toggleAudiofilter:function(b){const c=schedule.classList.toggle("schedule--audiofilter");return h(schedule.getAttribute("filter")||"more",c,schedule.classList.contains("schedule--group"),b),c},toggleGrouping:function(a){const b=schedule.classList.toggle("schedule--group");return h(schedule.getAttribute("filter")||"more",schedule.classList.contains("schedule--audiofilter"),b,a),b},openSettings:function(a){j=listSettings,schedule.classList.add("schedule--settings"),"function"==typeof a&&a()},openEvent:function(b,c){c="function"==typeof c?c:function(){},b.event.online?null===b.broadcast?(e(b.event),c(!1)):$settings.autoselect?($video.open(b.event,b.broadcast),c(null)):b.loading?c(null):a(b.event,b.broadcast,b,function(a){c(!!a||null)}):c(null)},refreshLinks:function(b,c,d){a(b,c,null,d)},closeEvent:function(a){a.classList.remove("event--open","event--loading"),a.getElementsByClassName("event-content")[0].innerHTML=""},openStream:function(a){const b=a.parentElement.parentElement.parentElement;$video.open(b.event,b.broadcast,a.stream)},list:()=>j,closeSub:b,mediaPlaying:function(a){a.streamObj&&a.streamObj.classList.add("stream--played")},reload:function(a,b){a&&$s365.resetKey(),h(schedule.getAttribute("filter")||"more",schedule.classList.contains("schedule--audiofilter"),schedule.classList.contains("schedule--group"),b)},init:function(a,b,c,d){a=a||"fb",schedule.setAttribute("filter",a),schedule.classList.toggle("schedule--audiofilter",!0===b),schedule.classList.toggle("schedule--group",!0===c),h(a,!0===b,!0===c,d)}}}(),$video=function(){var a=null;const b=function(a,b){return this.container=document.createElement("div"),this._status=0,this.event=a,this.broadcast=b,this.waiting=()=>{this.container.classList.add("video--loading"),this.container.removeAttribute("error"),this._status=1},this.buffer=()=>{},this.canplay=()=>{this.container.classList.remove("video--loading"),this.container.removeAttribute("error"),this._status=2},this.error=a=>{null!==a&&(this.container.setAttribute("error",a),this._status=-1)},this.isError=()=>-1===this._status,this.isWaiting=()=>1===this._status,this.stream=null,this.playing=a=>this.stream=a,this.nextStream=()=>{const a=this.broadcast.streams.length;if(this.stream&&1<a){let b=this.stream.id+1;b<a?$video.play(this.broadcast.streams[b]):$video.play(this.broadcast.streams[0])}},this.previousStream=()=>{const a=this.broadcast.streams.length;if(this.stream&&1<a){let b=this.stream.id-1;-1<b?$video.play(this.broadcast.streams[b]):$video.play(this.broadcast.streams[a-1])}},this.streamBar={error:()=>{},draw:()=>{}},this.videoBar={isOpen:()=>!1,open:()=>{},streamBar:this.streamBar,player:this},this.extendVideoBar=()=>(this.buffer=a=>videoSpinner.setAttribute("buffer",~~a),this.videoBar.obj=document.createElement("div"),this.videoBar.close=()=>(this.container.classList.remove("video--bar"),this),this.videoBar.open=()=>(this.container.classList.add("video--bar"),this.videoBar),this.videoBar.isOpen=()=>this.container.classList.contains("video--bar"),this.videoBar.refreshStreams=a=>{a="function"==typeof a?a:()=>{},this.streamBar.obj.classList.contains("video-streambar--loading")||(this.streamBar.obj.classList.add("video-streambar--loading"),$schedule.refreshLinks(this.event,this.broadcast,(b,c)=>{if(b){this.streamBar.draw(this.broadcast.streams);const b=this.broadcast.streams.find(a=>a.url===this.stream.url);b&&this.playing(b),a(b)}else this.streamBar.error(c)}))},this.streamBar.obj=document.createElement("div"),this.streamBar.draw=a=>{const b=this.streamBar.obj.firstChild;b.innerHTML="",a?(0===a.length?b.innerHTML="Keine Streams gefunden!":a.forEach((a,c)=>{const d=document.createElement("div");d.className="video-stream"+(a.played?" video-stream--played":""),d.innerHTML=c+1,d.stream=a,a.streamBarObj=d,$device.activateStreamBarStream(d),b.appendChild(d)}),this.streamBar.obj.classList.remove("video-streambar--loading")):this.streamBar.obj.classList.add("video-streambar--loading")},this.playing=a=>{this.stream&&this.stream.streamBarObj.classList.remove("video-stream--playing"),this.stream=a,a.streamBarObj.classList.add("video-stream--played","video-stream--playing"),this.streamBar.scrollStreamIntoView(a)},this.streamBar.scrollStreamIntoView=a=>{const b=a.streamBarObj;if(b&&b.offsetParent){const a=b.offsetParent,c=parseInt(window.getComputedStyle(b,null).marginLeft),d=b.offsetWidth;b.offsetLeft-c-d<a.scrollLeft?a.scrollLeft=b.offsetLeft-c-d:b.offsetLeft+b.offsetWidth+c+d>a.scrollLeft+a.offsetWidth&&(a.scrollLeft=b.offsetLeft+b.offsetWidth+c+d-a.offsetWidth)}},this.streamBar.error=a=>{this.streamBar.obj.firstChild.innerHTML="Fehler: "+a,this.streamBar.obj.classList.remove("video-streambar--loading")},this.container.innerHTML+="<div class=\"video-gradient\"></div>",this.videoBar.obj.className="video-bar",this.videoBar.obj.innerHTML="<div class=\"video-info\"><div class=\"video-info-meta\"><div class=\"video-info-time\">"+this.event.time+"</div><div class=\"video-info-lang\">"+this.broadcast.lang+"</div></div><div class=\"video-info-title\">"+this.event.title+"</div></div>",this.streamBar.obj.className="video-streambar video-streambar--loading",this.streamBar.obj.innerHTML="<span class=\"video-streams\"></span><div class=\"spinner video-streambar-spinner\"></div>",this.videoBar.obj.appendChild(this.streamBar.obj),this.container.appendChild(this.videoBar.obj),$device.activateVideoBar(this.videoBar),this.extendVideoBar=()=>{},this),this.container.className="video-container video--loading video-container--hidden",this.container.innerHTML+="<div id=\"videoSpinner\" class=\"spinner video-spinner\"></div>",document.body.appendChild(this.container),setTimeout(()=>this.container.classList.remove("video-container--hidden"),50),this};return{open:function(c,d,e){a=new b(c,d),$device.activatePlayer(a),null!==a.video&&(document.body.style.background="black",Array.isArray(d.streams)&&0!==d.streams.length?(a.streamBar.draw(d.streams),"undefined"==typeof e&&(e=d.streams[Math.floor(Math.random()*d.streams.length)]),$video.play(e)):$schedule.refreshLinks(c,d,(b,c)=>{if(b){const b=d.streams.length;a.streamBar.draw(d.streams),0===b?a.error("Keine Streams gefunden!"):(e=d.streams[Math.floor(Math.random()*b)],$video.play(e))}else a.error(c),a.streamBar.error(c)}))},play:function(b){null===a?console.error("$video.play: Kein Player!"):(a.waiting(),a.buffer(0),$schedule.mediaPlaying(b),a.playing(b),b.played=!0,$s365.getStream(b.url,function(b){$s365.adshell.attach(b.banner,function(){a.open(b.url)})},b=>a.error(b)))},close:function(){a&&!0!==a.isClosing&&(a.isClosing=!0,$s365.adshell.remove(),a.container.classList.add("video-container--hidden"),a.close(),document.body.style.background="#f0f0f0",setTimeout(()=>{a.container.remove(),a=null},500))},isOpen:()=>null!==a,getPlayer:()=>a}}();
